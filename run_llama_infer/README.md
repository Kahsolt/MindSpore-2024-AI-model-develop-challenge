# Run LLaMA infer

    ‰∏∫‰∫ÜËß£ÂÜ≥ÂπøÂ§ß‰∫∫Ê∞ëÁæ§‰ºóÁé©‰∏ç‰∫ÜÂ§ßÊ®°ÂûãÊé®ÁêÜÁöÑÊ†πÊú¨ÈóÆÈ¢òÔºåÊú¨ÊïôÁ®ãÁ†îÁ©∂Â¶Ç‰ΩïÂú® Windows Âπ≥Âè∞‰∏ä‰ΩøÁî® CPU/GPU ËÆæÂ§áËøêË°å mindformers ÊâÄÊèê‰æõÁöÑ LLaMA2-7b Âíå LLaMA3-8b Ê®°Âûã üéâüéâ

----

### Setup Mindformers

- `git clone https://gitee.com/kahsolt/mindformers`
  - ‚ö† ÈúÄË¶Å‰ΩøÁî®Êàë‰ª¨È≠îÊîπ‰πãÂêéÁöÑ mindformersÔºå‰∏çÁÑ∂Êúâ‰∫õ OS-specified API Âú® Windows ‰∏äË∑ë‰ºöÊä•Èîô
- ‰∏ãËΩΩÊùÉÈáç
  - run `run_llama_infer\checkpoint_download\llama2\download.cmd`
  - run `run_llama_infer\checkpoint_download\llama3\download.cmd`
  - (*) Â¶ÇÊûú‰Ω†Â∑≤ÁªèÊèêÂâç‰∏ãËΩΩÂà∞‰∫ÜÂà´ÁöÑÂú∞ÊñπÔºå‰∏çÁî®ÈáçÂ§ç‰∏ãËΩΩÊàñËÄÖÂ§çÂà∂Êñá‰ª∂ÔºåÊàë‰ª¨Êèê‰æõÂëΩ‰ª§Ë°åÂèÇÊï∞Êù•Âä®ÊÄÅÊåáÂÆöÂä†ËΩΩÊñá‰ª∂‰ΩçÁΩÆ


### Run tokenizer

- run `python run_tokenizer.py`
  - `-V <2|3>` ÊåáÂÆö llama ÁâàÊú¨
  - `-F <vocab_file>` Ëá™ÂÆö‰πâ `tokenizer.model` Êñá‰ª∂Ë∑ØÂæÑ
  - `--fast` ÊòØÂê¶‰ΩøÁî® fast ÁâàÊú¨ (‰ªÖÊîØÊåÅ llama2)


### Run model

‚ö† This runs but is extremely slow: 2~3 min per token on my i7-11700K@3.6GHz (8-core/16-thread) for LLaMA2-7b  
‚ö† LLaMA3-8b still CANNOt run, there's some ckpt load error :(  

- run `python run_model.py`
  - `-V <2|3>` ÊåáÂÆö llama ÁâàÊú¨
  - `-C <config_file>` ÊåáÂÆö yaml ÈÖçÁΩÆÊñá‰ª∂Ë∑ØÂæÑ
  - `-F <vocab_file>` Ëá™ÂÆö‰πâ `tokenizer.model` Êñá‰ª∂Ë∑ØÂæÑ
  - `-M <ckpt_file>` Ëá™ÂÆö‰πâ `llama_*.ckpt` Êñá‰ª∂Ë∑ØÂæÑ


### ckpt info

‚ö™ llama2-7b.ckpt

```
[Tokenizer]
vocab_size: 32000
vocab_size (with added tokens): 32003
[Model (dtype=fp16)]
- embed: [32000, 4096]
- Attn+FFW * 32
  - QKV: [4096, 4096]
  - FFW: 4096 => 11008 => 4096 (x2.6875)
- lm_head: [32000, 4096]
```

```cs
0 model.tok_embeddings.embedding_weight Float16 [32000, 4096]
1 model.layers.0.attention.wq.weight Float16 [4096, 4096]
2 model.layers.0.attention.wk.weight Float16 [4096, 4096]
3 model.layers.0.attention.wv.weight Float16 [4096, 4096]
4 model.layers.0.attention.wo.weight Float16 [4096, 4096]
5 model.layers.0.feed_forward.w1.weight Float16 [11008, 4096]
6 model.layers.0.feed_forward.w2.weight Float16 [4096, 11008]
7 model.layers.0.feed_forward.w3.weight Float16 [11008, 4096]
8 model.layers.0.attention_norm.weight Float16 [4096]
9 model.layers.0.ffn_norm.weight Float16 [4096]
10 model.layers.1.attention.wq.weight Float16 [4096, 4096]
11 model.layers.1.attention.wk.weight Float16 [4096, 4096]
12 model.layers.1.attention.wv.weight Float16 [4096, 4096]
13 model.layers.1.attention.wo.weight Float16 [4096, 4096]
14 model.layers.1.feed_forward.w1.weight Float16 [11008, 4096]
15 model.layers.1.feed_forward.w2.weight Float16 [4096, 11008]
16 model.layers.1.feed_forward.w3.weight Float16 [11008, 4096]
17 model.layers.1.attention_norm.weight Float16 [4096]
18 model.layers.1.ffn_norm.weight Float16 [4096]
19 model.layers.2.attention.wq.weight Float16 [4096, 4096]
20 model.layers.2.attention.wk.weight Float16 [4096, 4096]
21 model.layers.2.attention.wv.weight Float16 [4096, 4096]
22 model.layers.2.attention.wo.weight Float16 [4096, 4096]
23 model.layers.2.feed_forward.w1.weight Float16 [11008, 4096]
24 model.layers.2.feed_forward.w2.weight Float16 [4096, 11008]
25 model.layers.2.feed_forward.w3.weight Float16 [11008, 4096]
26 model.layers.2.attention_norm.weight Float16 [4096]
27 model.layers.2.ffn_norm.weight Float16 [4096]
28 model.layers.3.attention.wq.weight Float16 [4096, 4096]
29 model.layers.3.attention.wk.weight Float16 [4096, 4096]
30 model.layers.3.attention.wv.weight Float16 [4096, 4096]
31 model.layers.3.attention.wo.weight Float16 [4096, 4096]
32 model.layers.3.feed_forward.w1.weight Float16 [11008, 4096]
33 model.layers.3.feed_forward.w2.weight Float16 [4096, 11008]
34 model.layers.3.feed_forward.w3.weight Float16 [11008, 4096]
35 model.layers.3.attention_norm.weight Float16 [4096]
36 model.layers.3.ffn_norm.weight Float16 [4096]
37 model.layers.4.attention.wq.weight Float16 [4096, 4096]
38 model.layers.4.attention.wk.weight Float16 [4096, 4096]
39 model.layers.4.attention.wv.weight Float16 [4096, 4096]
40 model.layers.4.attention.wo.weight Float16 [4096, 4096]
41 model.layers.4.feed_forward.w1.weight Float16 [11008, 4096]
42 model.layers.4.feed_forward.w2.weight Float16 [4096, 11008]
43 model.layers.4.feed_forward.w3.weight Float16 [11008, 4096]
44 model.layers.4.attention_norm.weight Float16 [4096]
45 model.layers.4.ffn_norm.weight Float16 [4096]
46 model.layers.5.attention.wq.weight Float16 [4096, 4096]
47 model.layers.5.attention.wk.weight Float16 [4096, 4096]
48 model.layers.5.attention.wv.weight Float16 [4096, 4096]
49 model.layers.5.attention.wo.weight Float16 [4096, 4096]
50 model.layers.5.feed_forward.w1.weight Float16 [11008, 4096]
51 model.layers.5.feed_forward.w2.weight Float16 [4096, 11008]
52 model.layers.5.feed_forward.w3.weight Float16 [11008, 4096]
53 model.layers.5.attention_norm.weight Float16 [4096]
54 model.layers.5.ffn_norm.weight Float16 [4096]
55 model.layers.6.attention.wq.weight Float16 [4096, 4096]
56 model.layers.6.attention.wk.weight Float16 [4096, 4096]
57 model.layers.6.attention.wv.weight Float16 [4096, 4096]
58 model.layers.6.attention.wo.weight Float16 [4096, 4096]
59 model.layers.6.feed_forward.w1.weight Float16 [11008, 4096]
60 model.layers.6.feed_forward.w2.weight Float16 [4096, 11008]
61 model.layers.6.feed_forward.w3.weight Float16 [11008, 4096]
62 model.layers.6.attention_norm.weight Float16 [4096]
63 model.layers.6.ffn_norm.weight Float16 [4096]
64 model.layers.7.attention.wq.weight Float16 [4096, 4096]
65 model.layers.7.attention.wk.weight Float16 [4096, 4096]
66 model.layers.7.attention.wv.weight Float16 [4096, 4096]
67 model.layers.7.attention.wo.weight Float16 [4096, 4096]
68 model.layers.7.feed_forward.w1.weight Float16 [11008, 4096]
69 model.layers.7.feed_forward.w2.weight Float16 [4096, 11008]
70 model.layers.7.feed_forward.w3.weight Float16 [11008, 4096]
71 model.layers.7.attention_norm.weight Float16 [4096]
72 model.layers.7.ffn_norm.weight Float16 [4096]
73 model.layers.8.attention.wq.weight Float16 [4096, 4096]
74 model.layers.8.attention.wk.weight Float16 [4096, 4096]
75 model.layers.8.attention.wv.weight Float16 [4096, 4096]
76 model.layers.8.attention.wo.weight Float16 [4096, 4096]
77 model.layers.8.feed_forward.w1.weight Float16 [11008, 4096]
78 model.layers.8.feed_forward.w2.weight Float16 [4096, 11008]
79 model.layers.8.feed_forward.w3.weight Float16 [11008, 4096]
80 model.layers.8.attention_norm.weight Float16 [4096]
81 model.layers.8.ffn_norm.weight Float16 [4096]
82 model.layers.9.attention.wq.weight Float16 [4096, 4096]
83 model.layers.9.attention.wk.weight Float16 [4096, 4096]
84 model.layers.9.attention.wv.weight Float16 [4096, 4096]
85 model.layers.9.attention.wo.weight Float16 [4096, 4096]
86 model.layers.9.feed_forward.w1.weight Float16 [11008, 4096]
87 model.layers.9.feed_forward.w2.weight Float16 [4096, 11008]
88 model.layers.9.feed_forward.w3.weight Float16 [11008, 4096]
89 model.layers.9.attention_norm.weight Float16 [4096]
90 model.layers.9.ffn_norm.weight Float16 [4096]
91 model.layers.10.attention.wq.weight Float16 [4096, 4096]
92 model.layers.10.attention.wk.weight Float16 [4096, 4096]
93 model.layers.10.attention.wv.weight Float16 [4096, 4096]
94 model.layers.10.attention.wo.weight Float16 [4096, 4096]
95 model.layers.10.feed_forward.w1.weight Float16 [11008, 4096]
96 model.layers.10.feed_forward.w2.weight Float16 [4096, 11008]
97 model.layers.10.feed_forward.w3.weight Float16 [11008, 4096]
98 model.layers.10.attention_norm.weight Float16 [4096]
99 model.layers.10.ffn_norm.weight Float16 [4096]
100 model.layers.11.attention.wq.weight Float16 [4096, 4096]
101 model.layers.11.attention.wk.weight Float16 [4096, 4096]
102 model.layers.11.attention.wv.weight Float16 [4096, 4096]
103 model.layers.11.attention.wo.weight Float16 [4096, 4096]
104 model.layers.11.feed_forward.w1.weight Float16 [11008, 4096]
105 model.layers.11.feed_forward.w2.weight Float16 [4096, 11008]
106 model.layers.11.feed_forward.w3.weight Float16 [11008, 4096]
107 model.layers.11.attention_norm.weight Float16 [4096]
108 model.layers.11.ffn_norm.weight Float16 [4096]
109 model.layers.12.attention.wq.weight Float16 [4096, 4096]
110 model.layers.12.attention.wk.weight Float16 [4096, 4096]
111 model.layers.12.attention.wv.weight Float16 [4096, 4096]
112 model.layers.12.attention.wo.weight Float16 [4096, 4096]
113 model.layers.12.feed_forward.w1.weight Float16 [11008, 4096]
114 model.layers.12.feed_forward.w2.weight Float16 [4096, 11008]
115 model.layers.12.feed_forward.w3.weight Float16 [11008, 4096]
116 model.layers.12.attention_norm.weight Float16 [4096]
117 model.layers.12.ffn_norm.weight Float16 [4096]
118 model.layers.13.attention.wq.weight Float16 [4096, 4096]
119 model.layers.13.attention.wk.weight Float16 [4096, 4096]
120 model.layers.13.attention.wv.weight Float16 [4096, 4096]
121 model.layers.13.attention.wo.weight Float16 [4096, 4096]
122 model.layers.13.feed_forward.w1.weight Float16 [11008, 4096]
123 model.layers.13.feed_forward.w2.weight Float16 [4096, 11008]
124 model.layers.13.feed_forward.w3.weight Float16 [11008, 4096]
125 model.layers.13.attention_norm.weight Float16 [4096]
126 model.layers.13.ffn_norm.weight Float16 [4096]
127 model.layers.14.attention.wq.weight Float16 [4096, 4096]
128 model.layers.14.attention.wk.weight Float16 [4096, 4096]
129 model.layers.14.attention.wv.weight Float16 [4096, 4096]
130 model.layers.14.attention.wo.weight Float16 [4096, 4096]
131 model.layers.14.feed_forward.w1.weight Float16 [11008, 4096]
132 model.layers.14.feed_forward.w2.weight Float16 [4096, 11008]
133 model.layers.14.feed_forward.w3.weight Float16 [11008, 4096]
134 model.layers.14.attention_norm.weight Float16 [4096]
135 model.layers.14.ffn_norm.weight Float16 [4096]
136 model.layers.15.attention.wq.weight Float16 [4096, 4096]
137 model.layers.15.attention.wk.weight Float16 [4096, 4096]
138 model.layers.15.attention.wv.weight Float16 [4096, 4096]
139 model.layers.15.attention.wo.weight Float16 [4096, 4096]
140 model.layers.15.feed_forward.w1.weight Float16 [11008, 4096]
141 model.layers.15.feed_forward.w2.weight Float16 [4096, 11008]
142 model.layers.15.feed_forward.w3.weight Float16 [11008, 4096]
143 model.layers.15.attention_norm.weight Float16 [4096]
144 model.layers.15.ffn_norm.weight Float16 [4096]
145 model.layers.16.attention.wq.weight Float16 [4096, 4096]
146 model.layers.16.attention.wk.weight Float16 [4096, 4096]
147 model.layers.16.attention.wv.weight Float16 [4096, 4096]
148 model.layers.16.attention.wo.weight Float16 [4096, 4096]
149 model.layers.16.feed_forward.w1.weight Float16 [11008, 4096]
150 model.layers.16.feed_forward.w2.weight Float16 [4096, 11008]
151 model.layers.16.feed_forward.w3.weight Float16 [11008, 4096]
152 model.layers.16.attention_norm.weight Float16 [4096]
153 model.layers.16.ffn_norm.weight Float16 [4096]
154 model.layers.17.attention.wq.weight Float16 [4096, 4096]
155 model.layers.17.attention.wk.weight Float16 [4096, 4096]
156 model.layers.17.attention.wv.weight Float16 [4096, 4096]
157 model.layers.17.attention.wo.weight Float16 [4096, 4096]
158 model.layers.17.feed_forward.w1.weight Float16 [11008, 4096]
159 model.layers.17.feed_forward.w2.weight Float16 [4096, 11008]
160 model.layers.17.feed_forward.w3.weight Float16 [11008, 4096]
161 model.layers.17.attention_norm.weight Float16 [4096]
162 model.layers.17.ffn_norm.weight Float16 [4096]
163 model.layers.18.attention.wq.weight Float16 [4096, 4096]
164 model.layers.18.attention.wk.weight Float16 [4096, 4096]
165 model.layers.18.attention.wv.weight Float16 [4096, 4096]
166 model.layers.18.attention.wo.weight Float16 [4096, 4096]
167 model.layers.18.feed_forward.w1.weight Float16 [11008, 4096]
168 model.layers.18.feed_forward.w2.weight Float16 [4096, 11008]
169 model.layers.18.feed_forward.w3.weight Float16 [11008, 4096]
170 model.layers.18.attention_norm.weight Float16 [4096]
171 model.layers.18.ffn_norm.weight Float16 [4096]
172 model.layers.19.attention.wq.weight Float16 [4096, 4096]
173 model.layers.19.attention.wk.weight Float16 [4096, 4096]
174 model.layers.19.attention.wv.weight Float16 [4096, 4096]
175 model.layers.19.attention.wo.weight Float16 [4096, 4096]
176 model.layers.19.feed_forward.w1.weight Float16 [11008, 4096]
177 model.layers.19.feed_forward.w2.weight Float16 [4096, 11008]
178 model.layers.19.feed_forward.w3.weight Float16 [11008, 4096]
179 model.layers.19.attention_norm.weight Float16 [4096]
180 model.layers.19.ffn_norm.weight Float16 [4096]
181 model.layers.20.attention.wq.weight Float16 [4096, 4096]
182 model.layers.20.attention.wk.weight Float16 [4096, 4096]
183 model.layers.20.attention.wv.weight Float16 [4096, 4096]
184 model.layers.20.attention.wo.weight Float16 [4096, 4096]
185 model.layers.20.feed_forward.w1.weight Float16 [11008, 4096]
186 model.layers.20.feed_forward.w2.weight Float16 [4096, 11008]
187 model.layers.20.feed_forward.w3.weight Float16 [11008, 4096]
188 model.layers.20.attention_norm.weight Float16 [4096]
189 model.layers.20.ffn_norm.weight Float16 [4096]
190 model.layers.21.attention.wq.weight Float16 [4096, 4096]
191 model.layers.21.attention.wk.weight Float16 [4096, 4096]
192 model.layers.21.attention.wv.weight Float16 [4096, 4096]
193 model.layers.21.attention.wo.weight Float16 [4096, 4096]
194 model.layers.21.feed_forward.w1.weight Float16 [11008, 4096]
195 model.layers.21.feed_forward.w2.weight Float16 [4096, 11008]
196 model.layers.21.feed_forward.w3.weight Float16 [11008, 4096]
197 model.layers.21.attention_norm.weight Float16 [4096]
198 model.layers.21.ffn_norm.weight Float16 [4096]
199 model.layers.22.attention.wq.weight Float16 [4096, 4096]
200 model.layers.22.attention.wk.weight Float16 [4096, 4096]
201 model.layers.22.attention.wv.weight Float16 [4096, 4096]
202 model.layers.22.attention.wo.weight Float16 [4096, 4096]
203 model.layers.22.feed_forward.w1.weight Float16 [11008, 4096]
204 model.layers.22.feed_forward.w2.weight Float16 [4096, 11008]
205 model.layers.22.feed_forward.w3.weight Float16 [11008, 4096]
206 model.layers.22.attention_norm.weight Float16 [4096]
207 model.layers.22.ffn_norm.weight Float16 [4096]
208 model.layers.23.attention.wq.weight Float16 [4096, 4096]
209 model.layers.23.attention.wk.weight Float16 [4096, 4096]
210 model.layers.23.attention.wv.weight Float16 [4096, 4096]
211 model.layers.23.attention.wo.weight Float16 [4096, 4096]
212 model.layers.23.feed_forward.w1.weight Float16 [11008, 4096]
213 model.layers.23.feed_forward.w2.weight Float16 [4096, 11008]
214 model.layers.23.feed_forward.w3.weight Float16 [11008, 4096]
215 model.layers.23.attention_norm.weight Float16 [4096]
216 model.layers.23.ffn_norm.weight Float16 [4096]
217 model.layers.24.attention.wq.weight Float16 [4096, 4096]
218 model.layers.24.attention.wk.weight Float16 [4096, 4096]
219 model.layers.24.attention.wv.weight Float16 [4096, 4096]
220 model.layers.24.attention.wo.weight Float16 [4096, 4096]
221 model.layers.24.feed_forward.w1.weight Float16 [11008, 4096]
222 model.layers.24.feed_forward.w2.weight Float16 [4096, 11008]
223 model.layers.24.feed_forward.w3.weight Float16 [11008, 4096]
224 model.layers.24.attention_norm.weight Float16 [4096]
225 model.layers.24.ffn_norm.weight Float16 [4096]
226 model.layers.25.attention.wq.weight Float16 [4096, 4096]
227 model.layers.25.attention.wk.weight Float16 [4096, 4096]
228 model.layers.25.attention.wv.weight Float16 [4096, 4096]
229 model.layers.25.attention.wo.weight Float16 [4096, 4096]
230 model.layers.25.feed_forward.w1.weight Float16 [11008, 4096]
231 model.layers.25.feed_forward.w2.weight Float16 [4096, 11008]
232 model.layers.25.feed_forward.w3.weight Float16 [11008, 4096]
233 model.layers.25.attention_norm.weight Float16 [4096]
234 model.layers.25.ffn_norm.weight Float16 [4096]
235 model.layers.26.attention.wq.weight Float16 [4096, 4096]
236 model.layers.26.attention.wk.weight Float16 [4096, 4096]
237 model.layers.26.attention.wv.weight Float16 [4096, 4096]
238 model.layers.26.attention.wo.weight Float16 [4096, 4096]
239 model.layers.26.feed_forward.w1.weight Float16 [11008, 4096]
240 model.layers.26.feed_forward.w2.weight Float16 [4096, 11008]
241 model.layers.26.feed_forward.w3.weight Float16 [11008, 4096]
242 model.layers.26.attention_norm.weight Float16 [4096]
243 model.layers.26.ffn_norm.weight Float16 [4096]
244 model.layers.27.attention.wq.weight Float16 [4096, 4096]
245 model.layers.27.attention.wk.weight Float16 [4096, 4096]
246 model.layers.27.attention.wv.weight Float16 [4096, 4096]
247 model.layers.27.attention.wo.weight Float16 [4096, 4096]
248 model.layers.27.feed_forward.w1.weight Float16 [11008, 4096]
249 model.layers.27.feed_forward.w2.weight Float16 [4096, 11008]
250 model.layers.27.feed_forward.w3.weight Float16 [11008, 4096]
251 model.layers.27.attention_norm.weight Float16 [4096]
252 model.layers.27.ffn_norm.weight Float16 [4096]
253 model.layers.28.attention.wq.weight Float16 [4096, 4096]
254 model.layers.28.attention.wk.weight Float16 [4096, 4096]
255 model.layers.28.attention.wv.weight Float16 [4096, 4096]
256 model.layers.28.attention.wo.weight Float16 [4096, 4096]
257 model.layers.28.feed_forward.w1.weight Float16 [11008, 4096]
258 model.layers.28.feed_forward.w2.weight Float16 [4096, 11008]
259 model.layers.28.feed_forward.w3.weight Float16 [11008, 4096]
260 model.layers.28.attention_norm.weight Float16 [4096]
261 model.layers.28.ffn_norm.weight Float16 [4096]
262 model.layers.29.attention.wq.weight Float16 [4096, 4096]
263 model.layers.29.attention.wk.weight Float16 [4096, 4096]
264 model.layers.29.attention.wv.weight Float16 [4096, 4096]
265 model.layers.29.attention.wo.weight Float16 [4096, 4096]
266 model.layers.29.feed_forward.w1.weight Float16 [11008, 4096]
267 model.layers.29.feed_forward.w2.weight Float16 [4096, 11008]
268 model.layers.29.feed_forward.w3.weight Float16 [11008, 4096]
269 model.layers.29.attention_norm.weight Float16 [4096]
270 model.layers.29.ffn_norm.weight Float16 [4096]
271 model.layers.30.attention.wq.weight Float16 [4096, 4096]
272 model.layers.30.attention.wk.weight Float16 [4096, 4096]
273 model.layers.30.attention.wv.weight Float16 [4096, 4096]
274 model.layers.30.attention.wo.weight Float16 [4096, 4096]
275 model.layers.30.feed_forward.w1.weight Float16 [11008, 4096]
276 model.layers.30.feed_forward.w2.weight Float16 [4096, 11008]
277 model.layers.30.feed_forward.w3.weight Float16 [11008, 4096]
278 model.layers.30.attention_norm.weight Float16 [4096]
279 model.layers.30.ffn_norm.weight Float16 [4096]
280 model.layers.31.attention.wq.weight Float16 [4096, 4096]
281 model.layers.31.attention.wk.weight Float16 [4096, 4096]
282 model.layers.31.attention.wv.weight Float16 [4096, 4096]
283 model.layers.31.attention.wo.weight Float16 [4096, 4096]
284 model.layers.31.feed_forward.w1.weight Float16 [11008, 4096]
285 model.layers.31.feed_forward.w2.weight Float16 [4096, 11008]
286 model.layers.31.feed_forward.w3.weight Float16 [11008, 4096]
287 model.layers.31.attention_norm.weight Float16 [4096]
288 model.layers.31.ffn_norm.weight Float16 [4096]
289 model.norm_out.weight Float16 [4096]
290 lm_head.weight Float16 [32000, 4096]
```

‚ö™ llama3-8b.ckpt

```
[Tokenizer]
vocab_size: 128256
vocab_size (with added tokens): 128259
[Model (dtype=bf16)]
- embed: [128256, 4096]
- Attn+FFW * 32
  - Q: [4096, 4096]
  - KV: [1024, 4096]
  - FFW: 4096 => 14336 => 4096 (x3.5)
- lm_head: [128256, 4096]
```

Ckpt:

```cs
0 model.tok_embeddings.embedding_weight BFloat16 [128256, 4096]
1 model.tok_embeddings.embedding_weight BFloat16 [128256, 4096]
2 model.layers.0.attention.wq.weight BFloat16 [4096, 4096]
3 model.layers.0.attention.wk.weight BFloat16 [1024, 4096]
4 model.layers.0.attention.wv.weight BFloat16 [1024, 4096]
5 model.layers.0.attention.wo.weight BFloat16 [4096, 4096]
6 model.layers.0.feed_forward.w1.weight BFloat16 [14336, 4096]
7 model.layers.0.feed_forward.w3.weight BFloat16 [14336, 4096]
8 model.layers.0.feed_forward.w2.weight BFloat16 [4096, 14336]
9 model.layers.0.attention_norm.weight BFloat16 [4096]
10 model.layers.0.ffn_norm.weight BFloat16 [4096]
11 model.layers.1.attention.wq.weight BFloat16 [4096, 4096]
12 model.layers.1.attention.wk.weight BFloat16 [1024, 4096]
13 model.layers.1.attention.wv.weight BFloat16 [1024, 4096]
14 model.layers.1.attention.wo.weight BFloat16 [4096, 4096]
15 model.layers.1.feed_forward.w1.weight BFloat16 [14336, 4096]
16 model.layers.1.feed_forward.w3.weight BFloat16 [14336, 4096]
17 model.layers.1.feed_forward.w2.weight BFloat16 [4096, 14336]
18 model.layers.1.attention_norm.weight BFloat16 [4096]
19 model.layers.1.ffn_norm.weight BFloat16 [4096]
20 model.layers.2.attention.wq.weight BFloat16 [4096, 4096]
21 model.layers.2.attention.wk.weight BFloat16 [1024, 4096]
22 model.layers.2.attention.wv.weight BFloat16 [1024, 4096]
23 model.layers.2.attention.wo.weight BFloat16 [4096, 4096]
24 model.layers.2.feed_forward.w1.weight BFloat16 [14336, 4096]
25 model.layers.2.feed_forward.w3.weight BFloat16 [14336, 4096]
26 model.layers.2.feed_forward.w2.weight BFloat16 [4096, 14336]
27 model.layers.2.attention_norm.weight BFloat16 [4096]
28 model.layers.2.ffn_norm.weight BFloat16 [4096]
29 model.layers.3.attention.wq.weight BFloat16 [4096, 4096]
30 model.layers.3.attention.wk.weight BFloat16 [1024, 4096]
31 model.layers.3.attention.wv.weight BFloat16 [1024, 4096]
32 model.layers.3.attention.wo.weight BFloat16 [4096, 4096]
33 model.layers.3.feed_forward.w1.weight BFloat16 [14336, 4096]
34 model.layers.3.feed_forward.w3.weight BFloat16 [14336, 4096]
35 model.layers.3.feed_forward.w2.weight BFloat16 [4096, 14336]
36 model.layers.3.attention_norm.weight BFloat16 [4096]
37 model.layers.3.ffn_norm.weight BFloat16 [4096]
38 model.layers.4.attention.wq.weight BFloat16 [4096, 4096]
39 model.layers.4.attention.wk.weight BFloat16 [1024, 4096]
40 model.layers.4.attention.wv.weight BFloat16 [1024, 4096]
41 model.layers.4.attention.wo.weight BFloat16 [4096, 4096]
42 model.layers.4.feed_forward.w1.weight BFloat16 [14336, 4096]
43 model.layers.4.feed_forward.w3.weight BFloat16 [14336, 4096]
44 model.layers.4.feed_forward.w2.weight BFloat16 [4096, 14336]
45 model.layers.4.attention_norm.weight BFloat16 [4096]
46 model.layers.4.ffn_norm.weight BFloat16 [4096]
47 model.layers.5.attention.wq.weight BFloat16 [4096, 4096]
48 model.layers.5.attention.wk.weight BFloat16 [1024, 4096]
49 model.layers.5.attention.wv.weight BFloat16 [1024, 4096]
50 model.layers.5.attention.wo.weight BFloat16 [4096, 4096]
51 model.layers.5.feed_forward.w1.weight BFloat16 [14336, 4096]
52 model.layers.5.feed_forward.w3.weight BFloat16 [14336, 4096]
53 model.layers.5.feed_forward.w2.weight BFloat16 [4096, 14336]
54 model.layers.5.attention_norm.weight BFloat16 [4096]
55 model.layers.5.ffn_norm.weight BFloat16 [4096]
56 model.layers.6.attention.wq.weight BFloat16 [4096, 4096]
57 model.layers.6.attention.wk.weight BFloat16 [1024, 4096]
58 model.layers.6.attention.wv.weight BFloat16 [1024, 4096]
59 model.layers.6.attention.wo.weight BFloat16 [4096, 4096]
60 model.layers.6.feed_forward.w1.weight BFloat16 [14336, 4096]
61 model.layers.6.feed_forward.w3.weight BFloat16 [14336, 4096]
62 model.layers.6.feed_forward.w2.weight BFloat16 [4096, 14336]
63 model.layers.6.attention_norm.weight BFloat16 [4096]
64 model.layers.6.ffn_norm.weight BFloat16 [4096]
65 model.layers.7.attention.wq.weight BFloat16 [4096, 4096]
66 model.layers.7.attention.wk.weight BFloat16 [1024, 4096]
67 model.layers.7.attention.wv.weight BFloat16 [1024, 4096]
68 model.layers.7.attention.wo.weight BFloat16 [4096, 4096]
69 model.layers.7.feed_forward.w1.weight BFloat16 [14336, 4096]
70 model.layers.7.feed_forward.w3.weight BFloat16 [14336, 4096]
71 model.layers.7.feed_forward.w2.weight BFloat16 [4096, 14336]
72 model.layers.7.attention_norm.weight BFloat16 [4096]
73 model.layers.7.ffn_norm.weight BFloat16 [4096]
74 model.layers.8.attention.wq.weight BFloat16 [4096, 4096]
75 model.layers.8.attention.wk.weight BFloat16 [1024, 4096]
76 model.layers.8.attention.wv.weight BFloat16 [1024, 4096]
77 model.layers.8.attention.wo.weight BFloat16 [4096, 4096]
78 model.layers.8.feed_forward.w1.weight BFloat16 [14336, 4096]
79 model.layers.8.feed_forward.w3.weight BFloat16 [14336, 4096]
80 model.layers.8.feed_forward.w2.weight BFloat16 [4096, 14336]
81 model.layers.8.attention_norm.weight BFloat16 [4096]
82 model.layers.8.ffn_norm.weight BFloat16 [4096]
83 model.layers.9.attention.wq.weight BFloat16 [4096, 4096]
84 model.layers.9.attention.wk.weight BFloat16 [1024, 4096]
85 model.layers.9.attention.wv.weight BFloat16 [1024, 4096]
86 model.layers.9.attention.wo.weight BFloat16 [4096, 4096]
87 model.layers.9.feed_forward.w1.weight BFloat16 [14336, 4096]
88 model.layers.9.feed_forward.w3.weight BFloat16 [14336, 4096]
89 model.layers.9.feed_forward.w2.weight BFloat16 [4096, 14336]
90 model.layers.9.attention_norm.weight BFloat16 [4096]
91 model.layers.9.ffn_norm.weight BFloat16 [4096]
92 model.layers.10.attention.wq.weight BFloat16 [4096, 4096]
93 model.layers.10.attention.wk.weight BFloat16 [1024, 4096]
94 model.layers.10.attention.wv.weight BFloat16 [1024, 4096]
95 model.layers.10.attention.wo.weight BFloat16 [4096, 4096]
96 model.layers.10.feed_forward.w1.weight BFloat16 [14336, 4096]
97 model.layers.10.feed_forward.w3.weight BFloat16 [14336, 4096]
98 model.layers.10.feed_forward.w2.weight BFloat16 [4096, 14336]
99 model.layers.10.attention_norm.weight BFloat16 [4096]
100 model.layers.10.ffn_norm.weight BFloat16 [4096]
101 model.layers.11.attention.wq.weight BFloat16 [4096, 4096]
102 model.layers.11.attention.wk.weight BFloat16 [1024, 4096]
103 model.layers.11.attention.wv.weight BFloat16 [1024, 4096]
104 model.layers.11.attention.wo.weight BFloat16 [4096, 4096]
105 model.layers.11.feed_forward.w1.weight BFloat16 [14336, 4096]
106 model.layers.11.feed_forward.w3.weight BFloat16 [14336, 4096]
107 model.layers.11.feed_forward.w2.weight BFloat16 [4096, 14336]
108 model.layers.11.attention_norm.weight BFloat16 [4096]
109 model.layers.11.ffn_norm.weight BFloat16 [4096]
110 model.layers.12.attention.wq.weight BFloat16 [4096, 4096]
111 model.layers.12.attention.wk.weight BFloat16 [1024, 4096]
112 model.layers.12.attention.wv.weight BFloat16 [1024, 4096]
113 model.layers.12.attention.wo.weight BFloat16 [4096, 4096]
114 model.layers.12.feed_forward.w1.weight BFloat16 [14336, 4096]
115 model.layers.12.feed_forward.w3.weight BFloat16 [14336, 4096]
116 model.layers.12.feed_forward.w2.weight BFloat16 [4096, 14336]
117 model.layers.12.attention_norm.weight BFloat16 [4096]
118 model.layers.12.ffn_norm.weight BFloat16 [4096]
119 model.layers.13.attention.wq.weight BFloat16 [4096, 4096]
120 model.layers.13.attention.wk.weight BFloat16 [1024, 4096]
121 model.layers.13.attention.wv.weight BFloat16 [1024, 4096]
122 model.layers.13.attention.wo.weight BFloat16 [4096, 4096]
123 model.layers.13.feed_forward.w1.weight BFloat16 [14336, 4096]
124 model.layers.13.feed_forward.w3.weight BFloat16 [14336, 4096]
125 model.layers.13.feed_forward.w2.weight BFloat16 [4096, 14336]
126 model.layers.13.attention_norm.weight BFloat16 [4096]
127 model.layers.13.ffn_norm.weight BFloat16 [4096]
128 model.layers.14.attention.wq.weight BFloat16 [4096, 4096]
129 model.layers.14.attention.wk.weight BFloat16 [1024, 4096]
130 model.layers.14.attention.wv.weight BFloat16 [1024, 4096]
131 model.layers.14.attention.wo.weight BFloat16 [4096, 4096]
132 model.layers.14.feed_forward.w1.weight BFloat16 [14336, 4096]
133 model.layers.14.feed_forward.w3.weight BFloat16 [14336, 4096]
134 model.layers.14.feed_forward.w2.weight BFloat16 [4096, 14336]
135 model.layers.14.attention_norm.weight BFloat16 [4096]
136 model.layers.14.ffn_norm.weight BFloat16 [4096]
137 model.layers.15.attention.wq.weight BFloat16 [4096, 4096]
138 model.layers.15.attention.wk.weight BFloat16 [1024, 4096]
139 model.layers.15.attention.wv.weight BFloat16 [1024, 4096]
140 model.layers.15.attention.wo.weight BFloat16 [4096, 4096]
141 model.layers.15.feed_forward.w1.weight BFloat16 [14336, 4096]
142 model.layers.15.feed_forward.w3.weight BFloat16 [14336, 4096]
143 model.layers.15.feed_forward.w2.weight BFloat16 [4096, 14336]
144 model.layers.15.attention_norm.weight BFloat16 [4096]
145 model.layers.15.ffn_norm.weight BFloat16 [4096]
146 model.layers.16.attention.wq.weight BFloat16 [4096, 4096]
147 model.layers.16.attention.wk.weight BFloat16 [1024, 4096]
148 model.layers.16.attention.wv.weight BFloat16 [1024, 4096]
149 model.layers.16.attention.wo.weight BFloat16 [4096, 4096]
150 model.layers.16.feed_forward.w1.weight BFloat16 [14336, 4096]
151 model.layers.16.feed_forward.w3.weight BFloat16 [14336, 4096]
152 model.layers.16.feed_forward.w2.weight BFloat16 [4096, 14336]
153 model.layers.16.attention_norm.weight BFloat16 [4096]
154 model.layers.16.ffn_norm.weight BFloat16 [4096]
155 model.layers.17.attention.wq.weight BFloat16 [4096, 4096]
156 model.layers.17.attention.wk.weight BFloat16 [1024, 4096]
157 model.layers.17.attention.wv.weight BFloat16 [1024, 4096]
158 model.layers.17.attention.wo.weight BFloat16 [4096, 4096]
159 model.layers.17.feed_forward.w1.weight BFloat16 [14336, 4096]
160 model.layers.17.feed_forward.w3.weight BFloat16 [14336, 4096]
161 model.layers.17.feed_forward.w2.weight BFloat16 [4096, 14336]
162 model.layers.17.attention_norm.weight BFloat16 [4096]
163 model.layers.17.ffn_norm.weight BFloat16 [4096]
164 model.layers.18.attention.wq.weight BFloat16 [4096, 4096]
165 model.layers.18.attention.wk.weight BFloat16 [1024, 4096]
166 model.layers.18.attention.wv.weight BFloat16 [1024, 4096]
167 model.layers.18.attention.wo.weight BFloat16 [4096, 4096]
168 model.layers.18.feed_forward.w1.weight BFloat16 [14336, 4096]
169 model.layers.18.feed_forward.w3.weight BFloat16 [14336, 4096]
170 model.layers.18.feed_forward.w2.weight BFloat16 [4096, 14336]
171 model.layers.18.attention_norm.weight BFloat16 [4096]
172 model.layers.18.ffn_norm.weight BFloat16 [4096]
173 model.layers.19.attention.wq.weight BFloat16 [4096, 4096]
174 model.layers.19.attention.wk.weight BFloat16 [1024, 4096]
175 model.layers.19.attention.wv.weight BFloat16 [1024, 4096]
176 model.layers.19.attention.wo.weight BFloat16 [4096, 4096]
177 model.layers.19.feed_forward.w1.weight BFloat16 [14336, 4096]
178 model.layers.19.feed_forward.w3.weight BFloat16 [14336, 4096]
179 model.layers.19.feed_forward.w2.weight BFloat16 [4096, 14336]
180 model.layers.19.attention_norm.weight BFloat16 [4096]
181 model.layers.19.ffn_norm.weight BFloat16 [4096]
182 model.layers.20.attention.wq.weight BFloat16 [4096, 4096]
183 model.layers.20.attention.wk.weight BFloat16 [1024, 4096]
184 model.layers.20.attention.wv.weight BFloat16 [1024, 4096]
185 model.layers.20.attention.wo.weight BFloat16 [4096, 4096]
186 model.layers.20.feed_forward.w1.weight BFloat16 [14336, 4096]
187 model.layers.20.feed_forward.w3.weight BFloat16 [14336, 4096]
188 model.layers.20.feed_forward.w2.weight BFloat16 [4096, 14336]
189 model.layers.20.attention_norm.weight BFloat16 [4096]
190 model.layers.20.ffn_norm.weight BFloat16 [4096]
191 model.layers.21.attention.wq.weight BFloat16 [4096, 4096]
192 model.layers.21.attention.wk.weight BFloat16 [1024, 4096]
193 model.layers.21.attention.wv.weight BFloat16 [1024, 4096]
194 model.layers.21.attention.wo.weight BFloat16 [4096, 4096]
195 model.layers.21.feed_forward.w1.weight BFloat16 [14336, 4096]
196 model.layers.21.feed_forward.w3.weight BFloat16 [14336, 4096]
197 model.layers.21.feed_forward.w2.weight BFloat16 [4096, 14336]
198 model.layers.21.attention_norm.weight BFloat16 [4096]
199 model.layers.21.ffn_norm.weight BFloat16 [4096]
200 model.layers.22.attention.wq.weight BFloat16 [4096, 4096]
201 model.layers.22.attention.wk.weight BFloat16 [1024, 4096]
202 model.layers.22.attention.wv.weight BFloat16 [1024, 4096]
203 model.layers.22.attention.wo.weight BFloat16 [4096, 4096]
204 model.layers.22.feed_forward.w1.weight BFloat16 [14336, 4096]
205 model.layers.22.feed_forward.w3.weight BFloat16 [14336, 4096]
206 model.layers.22.feed_forward.w2.weight BFloat16 [4096, 14336]
207 model.layers.22.attention_norm.weight BFloat16 [4096]
208 model.layers.22.ffn_norm.weight BFloat16 [4096]
209 model.layers.23.attention.wq.weight BFloat16 [4096, 4096]
210 model.layers.23.attention.wk.weight BFloat16 [1024, 4096]
211 model.layers.23.attention.wv.weight BFloat16 [1024, 4096]
212 model.layers.23.attention.wo.weight BFloat16 [4096, 4096]
213 model.layers.23.feed_forward.w1.weight BFloat16 [14336, 4096]
214 model.layers.23.feed_forward.w3.weight BFloat16 [14336, 4096]
215 model.layers.23.feed_forward.w2.weight BFloat16 [4096, 14336]
216 model.layers.23.attention_norm.weight BFloat16 [4096]
217 model.layers.23.ffn_norm.weight BFloat16 [4096]
218 model.layers.24.attention.wq.weight BFloat16 [4096, 4096]
219 model.layers.24.attention.wk.weight BFloat16 [1024, 4096]
220 model.layers.24.attention.wv.weight BFloat16 [1024, 4096]
221 model.layers.24.attention.wo.weight BFloat16 [4096, 4096]
222 model.layers.24.feed_forward.w1.weight BFloat16 [14336, 4096]
223 model.layers.24.feed_forward.w3.weight BFloat16 [14336, 4096]
224 model.layers.24.feed_forward.w2.weight BFloat16 [4096, 14336]
225 model.layers.24.attention_norm.weight BFloat16 [4096]
226 model.layers.24.ffn_norm.weight BFloat16 [4096]
227 model.layers.25.attention.wq.weight BFloat16 [4096, 4096]
228 model.layers.25.attention.wk.weight BFloat16 [1024, 4096]
229 model.layers.25.attention.wv.weight BFloat16 [1024, 4096]
230 model.layers.25.attention.wo.weight BFloat16 [4096, 4096]
231 model.layers.25.feed_forward.w1.weight BFloat16 [14336, 4096]
232 model.layers.25.feed_forward.w3.weight BFloat16 [14336, 4096]
233 model.layers.25.feed_forward.w2.weight BFloat16 [4096, 14336]
234 model.layers.25.attention_norm.weight BFloat16 [4096]
235 model.layers.25.ffn_norm.weight BFloat16 [4096]
236 model.layers.26.attention.wq.weight BFloat16 [4096, 4096]
237 model.layers.26.attention.wk.weight BFloat16 [1024, 4096]
238 model.layers.26.attention.wv.weight BFloat16 [1024, 4096]
239 model.layers.26.attention.wo.weight BFloat16 [4096, 4096]
240 model.layers.26.feed_forward.w1.weight BFloat16 [14336, 4096]
241 model.layers.26.feed_forward.w3.weight BFloat16 [14336, 4096]
242 model.layers.26.feed_forward.w2.weight BFloat16 [4096, 14336]
243 model.layers.26.attention_norm.weight BFloat16 [4096]
244 model.layers.26.ffn_norm.weight BFloat16 [4096]
245 model.layers.27.attention.wq.weight BFloat16 [4096, 4096]
246 model.layers.27.attention.wk.weight BFloat16 [1024, 4096]
247 model.layers.27.attention.wv.weight BFloat16 [1024, 4096]
248 model.layers.27.attention.wo.weight BFloat16 [4096, 4096]
249 model.layers.27.feed_forward.w1.weight BFloat16 [14336, 4096]
250 model.layers.27.feed_forward.w3.weight BFloat16 [14336, 4096]
251 model.layers.27.feed_forward.w2.weight BFloat16 [4096, 14336]
252 model.layers.27.attention_norm.weight BFloat16 [4096]
253 model.layers.27.ffn_norm.weight BFloat16 [4096]
254 model.layers.28.attention.wq.weight BFloat16 [4096, 4096]
255 model.layers.28.attention.wk.weight BFloat16 [1024, 4096]
256 model.layers.28.attention.wv.weight BFloat16 [1024, 4096]
257 model.layers.28.attention.wo.weight BFloat16 [4096, 4096]
258 model.layers.28.feed_forward.w1.weight BFloat16 [14336, 4096]
259 model.layers.28.feed_forward.w3.weight BFloat16 [14336, 4096]
260 model.layers.28.feed_forward.w2.weight BFloat16 [4096, 14336]
261 model.layers.28.attention_norm.weight BFloat16 [4096]
262 model.layers.28.ffn_norm.weight BFloat16 [4096]
263 model.layers.29.attention.wq.weight BFloat16 [4096, 4096]
264 model.layers.29.attention.wk.weight BFloat16 [1024, 4096]
265 model.layers.29.attention.wv.weight BFloat16 [1024, 4096]
266 model.layers.29.attention.wo.weight BFloat16 [4096, 4096]
267 model.layers.29.feed_forward.w1.weight BFloat16 [14336, 4096]
268 model.layers.29.feed_forward.w3.weight BFloat16 [14336, 4096]
269 model.layers.29.feed_forward.w2.weight BFloat16 [4096, 14336]
270 model.layers.29.attention_norm.weight BFloat16 [4096]
271 model.layers.29.ffn_norm.weight BFloat16 [4096]
272 model.layers.30.attention.wq.weight BFloat16 [4096, 4096]
273 model.layers.30.attention.wk.weight BFloat16 [1024, 4096]
274 model.layers.30.attention.wv.weight BFloat16 [1024, 4096]
275 model.layers.30.attention.wo.weight BFloat16 [4096, 4096]
276 model.layers.30.feed_forward.w1.weight BFloat16 [14336, 4096]
277 model.layers.30.feed_forward.w3.weight BFloat16 [14336, 4096]
278 model.layers.30.feed_forward.w2.weight BFloat16 [4096, 14336]
279 model.layers.30.attention_norm.weight BFloat16 [4096]
280 model.layers.30.ffn_norm.weight BFloat16 [4096]
281 model.layers.31.attention.wq.weight BFloat16 [4096, 4096]
282 model.layers.31.attention.wk.weight BFloat16 [1024, 4096]
283 model.layers.31.attention.wv.weight BFloat16 [1024, 4096]
284 model.layers.31.attention.wo.weight BFloat16 [4096, 4096]
285 model.layers.31.feed_forward.w1.weight BFloat16 [14336, 4096]
286 model.layers.31.feed_forward.w3.weight BFloat16 [14336, 4096]
287 model.layers.31.feed_forward.w2.weight BFloat16 [4096, 14336]
288 model.layers.31.attention_norm.weight BFloat16 [4096]
289 model.layers.31.ffn_norm.weight BFloat16 [4096]
290 model.norm_out.weight BFloat16 [4096]
291 lm_head.weight BFloat16 [128256, 4096]
292 lm_head.weight BFloat16 [128256, 4096]
```

----
by Armit
2024/07/11 
